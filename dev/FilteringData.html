<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Filtering and Flattening Speckle Data in .NET | Speckle Docs</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script src="/scripts/scroll-to-hash.js"></script>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <meta name="description" content="Documentation on everything Speckle">
    <meta name="theme-color" content="#0480FB">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.df7ac8e6.css" as="style"><link rel="preload" href="/assets/js/app.4ab64a80.js" as="script"><link rel="preload" href="/assets/js/4.62813730.js" as="script"><link rel="preload" href="/assets/js/38.f7ada640.js" as="script"><link rel="prefetch" href="/assets/js/10.d524df53.js"><link rel="prefetch" href="/assets/js/11.f00c1b69.js"><link rel="prefetch" href="/assets/js/12.1cb372e4.js"><link rel="prefetch" href="/assets/js/13.0f391f45.js"><link rel="prefetch" href="/assets/js/14.e765e332.js"><link rel="prefetch" href="/assets/js/15.3241f44b.js"><link rel="prefetch" href="/assets/js/16.f181bd72.js"><link rel="prefetch" href="/assets/js/17.8a03ad2c.js"><link rel="prefetch" href="/assets/js/18.fdbc6dcf.js"><link rel="prefetch" href="/assets/js/19.db01c5f5.js"><link rel="prefetch" href="/assets/js/20.3079f2b5.js"><link rel="prefetch" href="/assets/js/21.8f7c0338.js"><link rel="prefetch" href="/assets/js/22.b84de467.js"><link rel="prefetch" href="/assets/js/23.1bfc7477.js"><link rel="prefetch" href="/assets/js/24.ab64a085.js"><link rel="prefetch" href="/assets/js/25.bae05938.js"><link rel="prefetch" href="/assets/js/26.ac531248.js"><link rel="prefetch" href="/assets/js/27.ca82045b.js"><link rel="prefetch" href="/assets/js/28.3861037b.js"><link rel="prefetch" href="/assets/js/29.5573c13b.js"><link rel="prefetch" href="/assets/js/3.114799bd.js"><link rel="prefetch" href="/assets/js/30.67cdf98d.js"><link rel="prefetch" href="/assets/js/31.aa81398e.js"><link rel="prefetch" href="/assets/js/32.c5be6ead.js"><link rel="prefetch" href="/assets/js/33.39758a0d.js"><link rel="prefetch" href="/assets/js/34.0a899626.js"><link rel="prefetch" href="/assets/js/35.ec0758d1.js"><link rel="prefetch" href="/assets/js/36.bd1a8753.js"><link rel="prefetch" href="/assets/js/37.34414609.js"><link rel="prefetch" href="/assets/js/39.cc49bd0b.js"><link rel="prefetch" href="/assets/js/40.394a8c0a.js"><link rel="prefetch" href="/assets/js/41.2e4cfad1.js"><link rel="prefetch" href="/assets/js/42.bcc593ac.js"><link rel="prefetch" href="/assets/js/43.d2a3c936.js"><link rel="prefetch" href="/assets/js/44.15b3daaf.js"><link rel="prefetch" href="/assets/js/45.2f41bbe2.js"><link rel="prefetch" href="/assets/js/46.165828a1.js"><link rel="prefetch" href="/assets/js/47.b8939fea.js"><link rel="prefetch" href="/assets/js/48.baeeb044.js"><link rel="prefetch" href="/assets/js/49.ad2f1c41.js"><link rel="prefetch" href="/assets/js/5.02b2fe19.js"><link rel="prefetch" href="/assets/js/50.001a52b2.js"><link rel="prefetch" href="/assets/js/51.8836574e.js"><link rel="prefetch" href="/assets/js/52.77a4b306.js"><link rel="prefetch" href="/assets/js/53.2d266828.js"><link rel="prefetch" href="/assets/js/54.15d8e70e.js"><link rel="prefetch" href="/assets/js/55.7ed5a2e4.js"><link rel="prefetch" href="/assets/js/56.136bd1ad.js"><link rel="prefetch" href="/assets/js/57.889074c8.js"><link rel="prefetch" href="/assets/js/58.8c964252.js"><link rel="prefetch" href="/assets/js/59.770ca7f7.js"><link rel="prefetch" href="/assets/js/6.3bcbfb04.js"><link rel="prefetch" href="/assets/js/60.0140de0e.js"><link rel="prefetch" href="/assets/js/61.4c272621.js"><link rel="prefetch" href="/assets/js/62.8f7e922e.js"><link rel="prefetch" href="/assets/js/63.4d28e62f.js"><link rel="prefetch" href="/assets/js/64.7e6d75e9.js"><link rel="prefetch" href="/assets/js/65.66ac1a2b.js"><link rel="prefetch" href="/assets/js/66.7af39f8d.js"><link rel="prefetch" href="/assets/js/67.11fc0132.js"><link rel="prefetch" href="/assets/js/7.c5f74ee1.js"><link rel="prefetch" href="/assets/js/8.f06ee2fd.js"><link rel="prefetch" href="/assets/js/9.62340eec.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.36f33616.js">
    <link rel="stylesheet" href="/assets/css/0.styles.df7ac8e6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/logo-docs.png" alt="Speckle Docs" class="logo"> <span class="site-name can-hide">Speckle Docs</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  User Guide
</a></div><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">
  Developer Docs
</a></div><div class="nav-item"><a href="https://speckle.systems" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Speckle Website
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://speckle.systems/getstarted/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Get Started
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/specklesystems/speckle-docs/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  User Guide
</a></div><div class="nav-item"><a href="/dev/" class="nav-link router-link-active">
  Developer Docs
</a></div><div class="nav-item"><a href="https://speckle.systems" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Speckle Website
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://speckle.systems/getstarted/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Get Started
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/specklesystems/speckle-docs/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Developer Docs 👩‍💻</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/dev/architecture.html" class="sidebar-link">Architecture</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Core Concepts</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/base.html" class="sidebar-link">The Base Object</a></li><li><a href="/dev/decomposition.html" class="sidebar-link">Decomposition API</a></li><li><a href="/dev/kits.html" class="sidebar-link">Kits</a></li><li><a href="/dev/transports.html" class="sidebar-link">Transports</a></li><li><a href="/dev/apps-auth.html" class="sidebar-link">Apps &amp; Auth</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Advanced Concepts</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>.NET SDK</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/dotnet.html" class="sidebar-link">Introduction</a></li><li><a href="/dev/FilteringData.html" aria-current="page" class="active sidebar-link">Filtering and Flattening Speckle Data in .NET</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev/FilteringData.html#step-1-let-s-flatten-the-data" class="sidebar-link">Step 1: Let's Flatten The Data</a></li><li class="sidebar-sub-header"><a href="/dev/FilteringData.html#step-2-let-s-query-the-data" class="sidebar-link">Step 2: Let's Query The Data</a></li><li class="sidebar-sub-header"><a href="/dev/FilteringData.html#conclusion-structured-data-vs-flat-data" class="sidebar-link">Conclusion: Structured Data vs. Flat Data</a></li></ul></li><li><a href="/dev/objects.html" class="sidebar-link">Objects Kit</a></li><li><a href="/dev/connectors-dev.html" class="sidebar-link">Writing Your Own Connector</a></li><li><a href="/dev/kits-dev.html" class="sidebar-link">Writing Your Own Kit</a></li><li><a href="/dev/transports-dev.html" class="sidebar-link">Writing Your Own Transport</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Python SDK</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/python.html" class="sidebar-link">Introduction</a></li><li><a href="/dev/py-examples.html" class="sidebar-link">Examples</a></li><li><a href="/dev/py-sample.html" class="sidebar-link">Tutorial: Simple Dashboard</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Javascript SDK</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/js.html" class="sidebar-link">Introduction</a></li><li><a href="/dev/viewer.html" class="sidebar-link">Using our embeddable 3D viewer</a></li><li><a href="/dev/js-app-script.html" class="sidebar-link">Using Google Apps Scripts</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Server API &amp; Apps</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev/server-api.html" class="sidebar-link">Introduction</a></li><li><a href="/dev/server-graphql-api.html" class="sidebar-link">GraphQL API</a></li><li><a href="/dev/server-rest-api.html" class="sidebar-link">REST API</a></li><li><a href="/dev/server-stream-previews.html" class="sidebar-link">Stream Preview Images</a></li><li><a href="/dev/server-webhooks.html" class="sidebar-link">Webhooks</a></li><li><a href="/dev/server-setup.html" class="sidebar-link">Deploying a Server - DigitalOcean Marketplace App</a></li><li><a href="/dev/server-manualsetup.html" class="sidebar-link">Deploying a Server - manual setup</a></li><li><a href="/dev/server-local-dev.html" class="sidebar-link">Local development environment</a></li><li><a href="/dev/tokens.html" class="sidebar-link">Personal Access Tokens</a></li><li><a href="/dev/apps.html" class="sidebar-link">Creating Your Own App</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="filtering-and-flattening-speckle-data-in-net"><a href="#filtering-and-flattening-speckle-data-in-net" class="header-anchor">#</a> Filtering and Flattening Speckle Data in .NET</h1> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Make sure you read the <a href="/dev/dotnet">introduction to .NET</a> before you dive in here! The most important sections you need to cover first are:</p> <ul><li><a href="/dev/dev/dotnet.html#structuring-your-data">Structuring Data</a></li> <li><a href="/dev/dotnet.html#receiving-data">Receiving</a></li></ul></div> <p>As you know, Speckle data is structured according to the conventions of the host application, domain or mental model of the developer. There is no single canonical way in which data is structured!</p> <p>Generally, working with structured data is a bit more difficult, as you need to parse the &quot;graph&quot;, or the tree that describes its structure. Nevertheless, this doesn't need to be so! What if we could access all the data inside a given commit and treat it just as any other list? Well, it's actually super easy!</p> <h2 id="step-1-let-s-flatten-the-data"><a href="#step-1-let-s-flatten-the-data" class="header-anchor">#</a> Step 1: Let's Flatten The Data</h2> <p>The extension method below flattens any <code>Base</code> object into its constituent parts: it returns a list of all its sub-<code>Base</code>s. <strong>Simply add this to your project somewhere and you're good to go.</strong></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Once we test this a bit more, we're probably going to add it to our Core SDK - so keep an eye out!</p></div> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Extensions</span>
<span class="token punctuation">{</span>
  <span class="token comment">// Flattens a base object into all its constituent parts.</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>Base<span class="token punctuation">&gt;</span></span> <span class="token function">Flatten</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">Base</span> obj<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token keyword">return</span> obj<span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> props <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">GetDynamicMemberNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> prop <span class="token keyword">in</span> props<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">var</span></span> <span class="token keyword">value</span> <span class="token operator">=</span> obj<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token keyword">is</span> <span class="token class-name">Base</span> b<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> nested <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">Flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> child <span class="token keyword">in</span> nested<span class="token punctuation">)</span> <span class="token keyword">yield</span> <span class="token keyword">return</span> child<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token keyword">is</span> <span class="token class-name">IDictionary</span> dict<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> dictValue <span class="token keyword">in</span> dict<span class="token punctuation">.</span>Values<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>dictValue <span class="token keyword">is</span> <span class="token class-name">Base</span> lb<span class="token punctuation">)</span>
          <span class="token punctuation">{</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> lbChild <span class="token keyword">in</span> lb<span class="token punctuation">.</span><span class="token function">Flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">yield</span> <span class="token keyword">return</span> lbChild<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token keyword">is</span> <span class="token class-name">IEnumerable</span> enumerable<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> listValue <span class="token keyword">in</span> enumerable<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>listValue <span class="token keyword">is</span> <span class="token class-name">Base</span> lb<span class="token punctuation">)</span>
          <span class="token punctuation">{</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> lbChild <span class="token keyword">in</span> lb<span class="token punctuation">.</span><span class="token function">Flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">yield</span> <span class="token keyword">return</span> lbChild<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h2 id="step-2-let-s-query-the-data"><a href="#step-2-let-s-query-the-data" class="header-anchor">#</a> Step 2: Let's Query The Data</h2> <p>Now that we have our flattening method in place, what can we do? Well - quite a lot! We can now use the power of LINQ to do complex queries on our dataset. For example, let's assume we want to get <strong>all the timber walls</strong> from a given building. How should we do that? Easy:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Speckle<span class="token punctuation">.</span>Core<span class="token punctuation">.</span>Api</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Speckle<span class="token punctuation">.</span>Core<span class="token punctuation">.</span>Models</span><span class="token punctuation">;</span>

<span class="token comment">// Note: some boilerplate code removed.</span>

<span class="token comment">// Receive a revit commit (note: you will need a local account on speckle.xyz for this to work!)</span>
<span class="token class-name"><span class="token keyword">var</span></span> data <span class="token operator">=</span> Helpers<span class="token punctuation">.</span><span class="token function">Receive</span><span class="token punctuation">(</span><span class="token string">&quot;https://speckle.xyz/streams/0d3cb7cb52/commits/681cdd572c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Result<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> flatData <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">Flatten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> timberWalls <span class="token operator">=</span> flatData<span class="token punctuation">.</span><span class="token function">FindAll</span><span class="token punctuation">(</span>obj <span class="token operator">=&gt;</span> obj <span class="token keyword">is</span> <span class="token class-name">Objects<span class="token punctuation">.</span>BuiltElements<span class="token punctuation">.</span>Revit<span class="token punctuation">.</span>RevitWall</span> wall <span class="token operator">&amp;&amp;</span> wall<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">&quot;Wall - Timber Clad&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>Check out the <a href="https://speckle.xyz/streams/0d3cb7cb52/commits/681cdd572c?filter=%7B%22ghostOthers%22%3Atrue,%22filterBy%22%3A%7B%22type%22%3A%5B%22Wall%20-%20Timber%20Clad%22%5D%7D,%22colorBy%22%3Anull%7D&amp;c=%5B8.38909,-14.62227,21.72508,19.02341,-4.21317,7.28914,0,1%5D" target="_blank" rel="noopener noreferrer">actual filtered timber walls here, in 3D<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>!</p> <p>Having fun? Let's try a couple more examples! Here's a query that will return all the <strong>windows</strong>:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>
<span class="token class-name"><span class="token keyword">var</span></span> windows <span class="token operator">=</span> flatData<span class="token punctuation">.</span><span class="token function">FindAll</span><span class="token punctuation">(</span>obj <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>obj<span class="token punctuation">[</span><span class="token string">&quot;category&quot;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;Windows&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Here are <a href="https://speckle.xyz/streams/0d3cb7cb52/commits/681cdd572c?filter=%7B%22ghostOthers%22%3Atrue,%22filterBy%22%3A%7B%22category%22%3A%5B%22Windows%22%5D%7D,%22colorBy%22%3A%7B%22type%22%3A%22category%22,%22property%22%3A%22category%22%7D%7D&amp;c=%5B-5.7784,-18.86637,18.78367,16.556,-1.104,4.3014,0,1%5D" target="_blank" rel="noopener noreferrer">the actual elements in our 3D viewer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>For extra fun, let's extract all the <a href="https://speckle.xyz/streams/0d3cb7cb52/commits/681cdd572c?filter=%7B%22ghostOthers%22%3Atrue,%22filterBy%22%3A%7B%22speckle_type%22%3A%5B%22Objects.BuiltElements.Room%22%5D%7D,%22colorBy%22%3Anull%7D&amp;c=%5B-3.83025,-15.78239,24.12586,16.556,-1.104,4.3014,0,1%5D" target="_blank" rel="noopener noreferrer"><strong>rooms</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>
<span class="token class-name"><span class="token keyword">var</span></span> rooms <span class="token operator">=</span> flatData<span class="token punctuation">.</span><span class="token function">FindAll</span><span class="token punctuation">(</span>obj <span class="token operator">=&gt;</span> obj <span class="token keyword">is</span> <span class="token class-name">Objects<span class="token punctuation">.</span>BuiltElements<span class="token punctuation">.</span>Room</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>All the <strong>levels</strong>:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>
<span class="token comment">// Note: to get only the unique levels, we need to de-duplicate them.</span>
<span class="token class-name"><span class="token keyword">var</span></span> levels <span class="token operator">=</span> flatData<span class="token punctuation">.</span><span class="token function">FindAll</span><span class="token punctuation">(</span>obj <span class="token operator">=&gt;</span> obj <span class="token keyword">is</span> <span class="token class-name">Objects<span class="token punctuation">.</span>BuiltElements<span class="token punctuation">.</span>Level</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Cast</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Objects<span class="token punctuation">.</span>BuiltElements<span class="token punctuation">.</span>Level<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>level <span class="token operator">=&gt;</span> level<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>g <span class="token operator">=&gt;</span> g<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>For a more complex query, let's try to create a summary of all the elements on each level. Here's how to achieve this with the power of LINQ:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>
<span class="token class-name"><span class="token keyword">var</span></span> elementsByLevel <span class="token operator">=</span> flatData<span class="token punctuation">.</span><span class="token function">FindAll</span><span class="token punctuation">(</span>obj <span class="token operator">=&gt;</span> obj<span class="token punctuation">[</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>obj <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span>obj<span class="token punctuation">[</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> grouping <span class="token keyword">in</span> elementsByLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;On level </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">grouping<span class="token punctuation">.</span>Key</span><span class="token punctuation">}</span></span><span class="token string"> there are </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">grouping<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string"> elements.&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>And the output:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>On level Level 1 there are 74 elements.
On level Roof Line there are 1 elements.
On level Ceiling there are 4 elements.
On level Level 2 there are 64 elements.
On level Level 1 Living Rm. there are 14 elements.
On level Foundation there are 31 elements.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="conclusion-structured-data-vs-flat-data"><a href="#conclusion-structured-data-vs-flat-data" class="header-anchor">#</a> Conclusion: Structured Data vs. Flat Data</h2> <p>Both structured data and flattened data have advantages and disadvanteges. The latter lends itself for ETL worflows and various classification based exercises, whereas the former allows for a better model. Dealing with structured data doesn't mean that we can't flatten it and benefit from all processing ease of flattened data. You can use this as a basis for quite a few automation exercises, such as:</p> <ul><li>automatically compiling bills of materials</li> <li>checking model quality (ie, why are there two Level 1s, <code>Level 1</code> and <code>Level 1 Living Rm</code> in that model?)</li> <li>creating custom schedules</li> <li>and more!</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/specklesystems/speckle-docs/edit/main/dev/FilteringData.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/11/2022, 7:55:14 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/dev/dotnet.html" class="prev">
        Introduction
      </a></span> <span class="next"><a href="/dev/objects.html">
        Objects Kit
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4ab64a80.js" defer></script><script src="/assets/js/4.62813730.js" defer></script><script src="/assets/js/38.f7ada640.js" defer></script>
  </body>
</html>
